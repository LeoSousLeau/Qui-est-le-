<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qui est le +</title>
  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; text-align: center; padding: 20px; }
    h1 { margin-bottom: 10px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; max-width: 800px; margin: auto; }
    .person { background: #222; border-radius: 12px; padding: 10px; cursor: pointer; transition: 0.2s; }
    .person:hover { background: #333; }
    img { width: 100%; border-radius: 12px; }
    .results { margin-top: 30px; max-width: 500px; margin: 30px auto; }
    .row { display: flex; justify-content: space-between; padding: 10px; background: #222; margin-bottom: 10px; border-radius: 8px; }
    #nextRound { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 8px; border: none; background: #444; color: #fff; }
    #nextRound:hover { background: #666; }
  </style>
</head>
<body>
  <h1 id="question">Qui est le + ?</h1>
  <p>Clique sur la personne pour voter.</p>

  <div class="grid" id="peopleGrid"></div>

  <h2>RÃ©sultats</h2>
  <div class="results" id="results"></div>

  <button id="nextRound" style="display:none;">Round suivant</button>

  <script>
    // ðŸ”¥ Configuration Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyDESmci3PRo5-T48BtmMQG04AxDH4BlYzA",
      authDomain: "qui-est-le-plus-7f7f2.firebaseapp.com",
      projectId: "qui-est-le-plus-7f7f2",
      storageBucket: "qui-est-le-plus-7f7f2.firebasestorage.app",
      messagingSenderId: "977215045643",
      appId: "1:977215045643:web:889a7467a1a17116df470e",
      measurementId: "G-38E1ERZB4Z"
    };

    // Initialiser Firebase
    var app = firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    // --- CONFIGURATION DU JEU ---
    var partyId = "ma-soiree-1";  // mÃªme pour tous les joueurs
    var totalPlayers = 3;         // nombre total de joueurs
    var rounds = ["drÃ´le", "intelligent", "sportif"];
    var currentRound = 0;

    // Joueurs avec photos
    var people = [
      { name: "Leonardo", img: "https://i.imgur.com/qarPxsq.png" },
      { name: "Enzo", img: "https://via.placeholder.com/150/66ff66" },
      { name: "Meline", img: "https://via.placeholder.com/150/6666ff" }
    ];

    var grid = document.getElementById("peopleGrid");
    var results = document.getElementById("results");
    var question = document.getElementById("question");
    var nextRoundBtn = document.getElementById("nextRound");

    var selectedVote = null; // stocke le vote local

    // Affichage des participants
    function displayPeople() {
      grid.innerHTML = "";
      people.forEach(function(p) {
        var div = document.createElement("div");
        div.className = "person";
        div.innerHTML = "<img src='" + p.img + "' /><p>" + p.name + "</p>";
        div.onclick = function() { selectVote(p.name, div); };
        grid.appendChild(div);
      });
    }

    displayPeople();

    function selectVote(name, divElement) {
      selectedVote = name;
      // mettre en Ã©vidence le choix local
      document.querySelectorAll(".person").forEach(el => el.style.border = "none");
      divElement.style.border = "3px solid yellow";
    }

    // Valider le vote et l'envoyer Ã  Firebase
    function submitVote() {
      if (!selectedVote) {
        alert("Choisis quelqu'un avant de valider !");
        return;
      }
      db.collection("votes").add({
        person: selectedVote,
        round: rounds[currentRound],
        party: partyId,
        date: Date.now()
      }).then(() => {
        // dÃ©sactiver le clic aprÃ¨s vote
        document.querySelectorAll(".person").forEach(el => el.style.pointerEvents = "none");
      });
    }

    // Ã‰couter les votes et rÃ©vÃ©ler quand tout le monde a votÃ©
    function listenVotes() {
      db.collection("votes")
        .where("round", "==", rounds[currentRound])
        .where("party", "==", partyId)
        .onSnapshot(function(snap) {
          if (snap.size === totalPlayers) {
            // compter les votes
            var counts = {};
            people.forEach(p => counts[p.name] = 0);
            snap.forEach(doc => {
              var v = doc.data().person;
              if (counts[v] !== undefined) counts[v]++;
            });

            // trier par votes
            var sorted = Object.entries(counts).sort((a,b) => b[1]-a[1]);

            // afficher les rÃ©sultats
            results.innerHTML = sorted.map(entry => 
              "<div class='row'><span>" + entry[0] + "</span><span>" + entry[1] + " votes</span></div>"
            ).join("");

            nextRoundBtn.style.display = "inline-block";
          }
        });
    }

    listenVotes();

    nextRoundBtn.onclick = function() {
      currentRound++;
      if (currentRound >= rounds.length) {
        alert("Fin des rounds !");
        question.innerText = "Merci d'avoir jouÃ© !";
        grid.innerHTML = "";
        results.innerHTML = "";
        nextRoundBtn.style.display = "none";
      } else {
        question.innerText = "Qui est le + " + rounds[currentRound] + " ?";
        results.innerHTML = "";
        displayPeople();
        selectedVote = null;
        // rÃ©activer le clic
        document.querySelectorAll(".person").forEach(el => el.style.pointerEvents = "auto");
        nextRoundBtn.style.display = "none";
        listenVotes();
      }
    };

    // Ajout d'un bouton pour valider son vote
    var voteBtn = document.createElement("button");
    voteBtn.innerText = "Valider mon vote";
    voteBtn.style.marginTop = "20px";
    voteBtn.style.padding = "10px 20px";
    voteBtn.style.fontSize = "16px";
    voteBtn.style.bor
